--------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/data/ransom/frictions-JHR/Data/Input/ACSpindex/an_adj_rent_MSA.log
  log type:  text
 opened on:  30 Jan 2021, 20:29:22

. 
. use ACS2005raw, clear

. 
. run metarea_CBSA_mapping

. 
. drop if qacrehou > 0 | qbedroom > 0 | qbuilty2 > 0 | qkitchen > 0 | qrooms   > 0 | qunitsst > 0 
> | gq>1 // drop any imputed values and any group quarters
(442,157 observations deleted)

. drop if metarea==0 // drop areas that are undisclosed
(697,991 observations deleted)

. 
. gen logrent = ln(rentgrs)
(1,420,681 missing values generated)

. 
. qui tab bedrooms, gen(bed_dum)

. qui tab rooms, gen(room_dum)

. qui tab builtyr2, gen(age_dum)

. qui tab unitsstr, gen(units_dum)

. qui tab plumbing, gen(plumbing_dum)

. qui tab kitchen, gen(kitchen_dum)

. qui tab acrehous, gen(acre_dum)

. qui tab cbsa_code, gen(metro_dum)

. 
. local regressors bed_dum* room_dum* age_dum* units_dum* plumbing_dum* kitchen_dum* acre_dum*

. 
. count
  1,738,232

. areg logrent `regressors', absorb(cbsa_code) // metro_dum2-metro_dum265
note: bed_dum6 omitted because of collinearity
note: room_dum9 omitted because of collinearity
note: age_dum9 omitted because of collinearity
note: units_dum10 omitted because of collinearity
note: plumbing_dum2 omitted because of collinearity
note: kitchen_dum2 omitted because of collinearity
note: acre_dum1 omitted because of collinearity
note: acre_dum3 omitted because of collinearity

Linear regression, absorbing indicators         Number of obs     =    317,551
                                                F(  33, 317253)   =    2622.63
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3316
                                                Adj R-squared     =     0.3310
                                                Root MSE          =     0.4445

-------------------------------------------------------------------------------
      logrent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
     bed_dum1 |  -.2702335   .0138343   -19.53   0.000    -.2973484   -.2431186
     bed_dum2 |  -.1913533    .008126   -23.55   0.000    -.2072801   -.1754265
     bed_dum3 |   .0159377   .0075503     2.11   0.035     .0011393    .0307361
     bed_dum4 |   .0554878   .0072209     7.68   0.000     .0413351    .0696405
     bed_dum5 |   .0600833   .0070841     8.48   0.000     .0461988    .0739679
     bed_dum6 |          0  (omitted)
    room_dum1 |  -.4007771   .0152187   -26.33   0.000    -.4306054   -.3709488
    room_dum2 |  -.3357564   .0084792   -39.60   0.000    -.3523755   -.3191373
    room_dum3 |  -.3421819   .0077269   -44.28   0.000    -.3573264   -.3270374
    room_dum4 |  -.3306541     .00729   -45.36   0.000    -.3449423   -.3163658
    room_dum5 |  -.2742444   .0070174   -39.08   0.000    -.2879983   -.2604905
    room_dum6 |  -.1888719   .0069026   -27.36   0.000    -.2024009   -.1753429
    room_dum7 |  -.1100984   .0069909   -15.75   0.000    -.1238004   -.0963964
    room_dum8 |  -.0276485   .0075195    -3.68   0.000    -.0423864   -.0129105
    room_dum9 |          0  (omitted)
     age_dum1 |  -.2410271   .0152755   -15.78   0.000    -.2709666   -.2110877
     age_dum2 |  -.2843242   .0154162   -18.44   0.000    -.3145396   -.2541088
     age_dum3 |  -.2741965   .0152901   -17.93   0.000    -.3041647   -.2442283
     age_dum4 |  -.2449554   .0152566   -16.06   0.000    -.2748578    -.215053
     age_dum5 |  -.2026258   .0152082   -13.32   0.000    -.2324335   -.1728181
     age_dum6 |  -.1211793   .0152388    -7.95   0.000     -.151047   -.0913116
     age_dum7 |  -.0206473   .0152756    -1.35   0.176    -.0505871    .0092924
     age_dum8 |   .0626014   .0153576     4.08   0.000      .032501    .0927019
     age_dum9 |          0  (omitted)
   units_dum1 |  -.3353633   .0098666   -33.99   0.000    -.3547016    -.316025
   units_dum2 |  -.4013419   .0412693    -9.72   0.000    -.4822285   -.3204553
   units_dum3 |     .04465   .0090098     4.96   0.000      .026991     .062309
   units_dum4 |  -.0650822   .0093654    -6.95   0.000    -.0834382   -.0467263
   units_dum5 |   .0584098   .0038722    15.08   0.000     .0508204    .0659992
   units_dum6 |   .0256357   .0035288     7.26   0.000     .0187193     .032552
   units_dum7 |  -.0059681    .003415    -1.75   0.081    -.0126615    .0007252
   units_dum8 |   .0134665   .0034572     3.90   0.000     .0066904    .0202426
   units_dum9 |  -.0098183   .0036954    -2.66   0.008    -.0170611   -.0025754
  units_dum10 |          0  (omitted)
plumbing_dum1 |  -.1612225   .0143205   -11.26   0.000    -.1892903   -.1331548
plumbing_dum2 |          0  (omitted)
 kitchen_dum1 |   .0462851   .0103756     4.46   0.000     .0259493     .066621
 kitchen_dum2 |          0  (omitted)
    acre_dum1 |          0  (omitted)
    acre_dum2 |     .15924   .0085092    18.71   0.000     .1425623    .1759178
    acre_dum3 |          0  (omitted)
        _cons |   7.120745   .0165522   430.20   0.000     7.088303    7.153186
--------------+----------------------------------------------------------------
    cbsa_code |    F(264, 317253) =    336.684   0.000         (265 categories)

. matrix coeffs = e(b)'

. predict fixed_effects, d
(1,420,681 missing values generated)

. 
. preserve

.         collapse fixed_effects , by(cbsa_code)

.         mkmat fixed_effects cbsa_code, matrix(FE) nomissing

. restore

. 
. matrix accum A = `regressors' , noconstant deviations means(matmeans)
(obs=1,738,232)

. matrix matmeans = [matmeans,1]

. 
. ** need to repmat "matmeans" 265 times ... or collapse the regressor means by location to get a 
> 265 x K matrix ........
. matrix matmeans = J(265,1,1)*matmeans

. 
. mata
------------------------------------------------- mata (type end to exit) ------------------------
: zed = st_matrix("FE")

: zed1 = zed[.,1]

: zed2 = zed[.,2]

: st_matrix("FE1",zed1)

: st_matrix("FEnames",zed2)

: end
--------------------------------------------------------------------------------------------------

. matrix prices = matmeans*coeffs + FE1

. 
. svmat prices, names(locprice)

. egen mean_price = mean(locprice)

. sum mean_price

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  mean_price |  1,738,232     6.77844           0    6.77844    6.77844

. svmat FEnames, names(locnames)

. 
. preserve

. keep locprice1 locnames1 mean_price

. keep if locprice1<.
(1,737,967 observations deleted)

. ren locnames1 cbsa_code

. ren locprice1 grents

. * replace grents = grents/mean_price*100 // deflate gross rents by mean location AFTER merging i
> n with ACCRA data
. drop mean_price

. sum grents

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      grents |        265     6.77844    .2103009   6.310488   7.469079

. l

     +---------------------+
     |   grents   cbsa_c~e |
     |---------------------|
  1. | 6.673789      10180 |
  2. |   6.7298      10420 |
  3. | 6.563501      10500 |
  4. | 6.870646      10580 |
  5. | 6.756371      10740 |
     |---------------------|
  6. | 6.540394      10780 |
  7. |  6.90706      10900 |
  8. | 6.441641      11020 |
  9. |  6.68611      11100 |
 10. | 7.186187      11260 |
     |---------------------|
 11. | 7.037372      11460 |
 12. | 6.478002      11500 |
 13. | 6.707264      11540 |
 14. | 6.757873      11700 |
 15. | 6.731807      12020 |
     |---------------------|
 16. | 6.941696      12060 |
 17. | 6.963372      12100 |
 18. | 6.656324      12220 |
 19. | 6.657002      12260 |
 20. | 6.984955      12420 |
     |---------------------|
 21. | 6.739325      12540 |
 22. | 7.002744      12580 |
 23. | 7.125183      12700 |
 24. | 6.718545      12940 |
 25. | 6.656684      13140 |
     |---------------------|
 26. | 6.820514      13380 |
 27. | 6.767413      13740 |
 28. |  6.65145      13780 |
 29. | 6.756808      13820 |
 30. | 6.828882      14020 |
     |---------------------|
 31. | 6.754665      14060 |
 32. | 6.709549      14260 |
 33. | 7.234495      14460 |
 34. | 6.851169      14740 |
 35. | 7.312267      14860 |
     |---------------------|
 36. |  6.45307      15180 |
 37. | 6.686837      15380 |
 38. | 6.557567      15940 |
 39. | 6.973945      15980 |
 40. | 6.727032      16300 |
     |---------------------|
 41. | 6.838284      16580 |
 42. | 6.887825      16700 |
 43. | 6.747521      16740 |
 44. | 6.976428      16820 |
 45. | 6.599584      16860 |
     |---------------------|
 46. | 7.055631      16980 |
 47. |  6.89122      17020 |
 48. | 6.773801      17140 |
 49. | 6.609733      17300 |
 50. | 6.776989      17460 |
     |---------------------|
 51. | 6.782322      17780 |
 52. | 6.893339      17820 |
 53. | 6.666534      17860 |
 54. | 6.779036      17900 |
 55. | 6.614621      17980 |
     |---------------------|
 56. | 6.815001      18140 |
 57. |  6.81706      18580 |
 58. | 6.918204      18880 |
 59. | 6.938291      19100 |
 60. | 6.491652      19260 |
     |---------------------|
 61. | 6.695204      19340 |
 62. | 6.692365      19380 |
 63. | 6.431855      19460 |
 64. | 6.582413      19500 |
 65. | 6.852229      19660 |
     |---------------------|
 66. | 6.982631      19740 |
 67. |  6.83261      19780 |
 68. | 6.877894      19820 |
 69. | 6.417452      20020 |
 70. | 6.855311      20100 |
     |---------------------|
 71. | 6.652463      20260 |
 72. |  6.69849      20740 |
 73. | 6.659235      21140 |
 74. | 6.467945      21340 |
 75. | 6.541119      21500 |
     |---------------------|
 76. |  6.82119      21660 |
 77. | 6.610104      21780 |
 78. | 6.629403      22020 |
 79. | 6.714192      22180 |
 80. | 6.630772      22220 |
     |---------------------|
 81. | 6.820013      22380 |
 82. | 6.601728      22420 |
 83. | 6.378966      22520 |
 84. | 6.915489      22660 |
 85. | 6.510857      22900 |
     |---------------------|
 86. | 6.605731      23060 |
 87. | 6.798161      23420 |
 88. | 6.463214      23460 |
 89. | 6.865924      23540 |
 90. | 6.711537      24020 |
     |---------------------|
 91. | 6.507473      24140 |
 92. | 6.728508      24300 |
 93. | 6.827763      24540 |
 94. | 6.715105      24580 |
 95. | 6.715284      24660 |
     |---------------------|
 96. | 6.544393      24780 |
 97. | 6.621401      24860 |
 98. | 6.645608      25060 |
 99. | 6.680394      25180 |
100. | 6.683697      25420 |
     |---------------------|
101. | 7.005143      25540 |
102. | 6.598026      25620 |
103. | 6.486959      25860 |
104. | 7.281585      26180 |
105. | 6.613365      26380 |
     |---------------------|
106. | 6.925205      26420 |
107. |  6.60438      26620 |
108. | 6.782884      26900 |
109. | 6.874072      26980 |
110. | 6.740698      27100 |
     |---------------------|
111. | 6.715848      27140 |
112. | 6.607078      27180 |
113. | 6.876793      27260 |
114. | 6.653074      27340 |
115. | 6.529805      27460 |
     |---------------------|
116. | 6.697085      27500 |
117. | 6.378082      27740 |
118. | 6.310488      27780 |
119. |  6.54682      27900 |
120. | 6.683785      28020 |
     |---------------------|
121. | 6.741077      28100 |
122. | 6.813086      28140 |
123. | 6.851435      28420 |
124. | 6.673227      28660 |
125. | 6.599274      28940 |
     |---------------------|
126. | 6.675554      29020 |
127. | 6.616827      29100 |
128. | 6.746989      29140 |
129. | 6.587911      29180 |
130. | 6.576415      29340 |
     |---------------------|
131. | 6.804419      29460 |
132. | 6.839445      29540 |
133. | 6.816604      29620 |
134. | 6.552281      29700 |
135. | 6.544562      29740 |
     |---------------------|
136. | 7.021347      29820 |
137. | 6.725574      30460 |
138. | 6.502659      30620 |
139. | 6.722144      30700 |
140. | 6.680714      30780 |
     |---------------------|
141. | 6.614064      30980 |
142. | 7.300603      31100 |
143. | 6.707142      31140 |
144. | 6.789667      31180 |
145. | 6.519308      31340 |
     |---------------------|
146. | 6.656326      31420 |
147. | 7.028342      31540 |
148. | 7.142406      31700 |
149. | 6.515011      31900 |
150. | 6.454597      32580 |
     |---------------------|
151. | 6.746456      32780 |
152. | 6.838697      32820 |
153. | 6.773388      32900 |
154. | 7.113861      33100 |
155. | 6.890265      33340 |
     |---------------------|
156. | 7.023526      33460 |
157. | 6.617358      33660 |
158. | 6.951687      33700 |
159. | 6.584378      33740 |
160. | 6.654252      33860 |
     |---------------------|
161. | 6.541439      34620 |
162. | 6.750173      34740 |
163. | 6.756514      34820 |
164. | 7.187741      34940 |
165. | 6.735956      34980 |
     |---------------------|
166. | 7.012593      35300 |
167. | 6.756094      35380 |
168. | 7.262492      35620 |
169. | 6.558258      35660 |
170. | 7.119486      35840 |
     |---------------------|
171. | 6.755825      36100 |
172. | 6.637467      36220 |
173. | 6.715401      36420 |
174. | 6.888618      36500 |
175. | 6.752695      36540 |
     |---------------------|
176. | 6.956338      36740 |
177. | 7.334327      37100 |
178. | 6.927805      37340 |
179. | 6.759371      37460 |
180. | 6.697699      37860 |
     |---------------------|
181. | 6.643641      37900 |
182. |  7.03341      37980 |
183. | 6.931713      38060 |
184. | 6.679455      38300 |
185. | 6.907036      38860 |
     |---------------------|
186. | 6.917304      38900 |
187. | 6.917698      38940 |
188. | 7.139751      39100 |
189. | 6.860323      39300 |
190. | 6.771163      39340 |
     |---------------------|
191. | 6.583703      39380 |
192. | 6.918415      39460 |
193. | 6.859713      39540 |
194. | 6.827414      39580 |
195. | 6.785308      39740 |
     |---------------------|
196. | 6.837532      39820 |
197. | 7.042078      39900 |
198. | 6.881801      40060 |
199. | 7.059302      40140 |
200. | 6.661788      40220 |
     |---------------------|
201. |  6.85262      40340 |
202. | 6.881504      40380 |
203. | 6.719041      40420 |
204. | 6.558224      40580 |
205. | 7.101038      40900 |
     |---------------------|
206. | 6.631832      40980 |
207. | 6.667337      41060 |
208. | 6.585022      41140 |
209. | 6.758264      41180 |
210. | 6.697651      41420 |
     |---------------------|
211. | 7.353737      41500 |
212. | 6.814273      41620 |
213. | 6.736561      41700 |
214. | 7.315754      41740 |
215. | 7.413371      41860 |
     |---------------------|
216. | 7.469079      41940 |
217. | 7.169067      42020 |
218. | 7.307079      42060 |
219. | 7.391202      42100 |
220. | 6.925358      42140 |
     |---------------------|
221. | 7.264855      42220 |
222. | 6.896285      42340 |
223. | 6.513981      42540 |
224. | 7.054004      42660 |
225. | 6.690746      43100 |
     |---------------------|
226. | 6.555697      43340 |
227. | 6.690217      43580 |
228. | 6.754766      43620 |
229. | 6.722504      43780 |
230. | 6.723485      44060 |
     |---------------------|
231. | 6.614746      44100 |
232. | 6.810327      44140 |
233. | 6.588161      44180 |
234. | 6.871496      44300 |
235. | 7.009523      44700 |
     |---------------------|
236. |   6.5097      44940 |
237. | 6.727405      45060 |
238. | 6.860771      45220 |
239. | 6.940184      45300 |
240. | 6.588286      45460 |
     |---------------------|
241. | 6.699599      45780 |
242. | 6.678427      45820 |
243. |  7.20611      45940 |
244. | 6.814802      46060 |
245. | 6.703023      46140 |
     |---------------------|
246. | 6.631285      46220 |
247. | 6.774004      46340 |
248. | 6.588304      46540 |
249. | 6.788727      47220 |
250. | 6.933433      47260 |
     |---------------------|
251. | 6.641257      47300 |
252. | 6.753747      47380 |
253. | 7.301265      47900 |
254. |  6.63695      47940 |
255. |   6.6138      48140 |
     |---------------------|
256. | 6.683824      48620 |
257. | 6.698567      48660 |
258. | 6.508275      48700 |
259. | 6.806953      48900 |
260. | 6.952298      49340 |
     |---------------------|
261. | 6.585357      49420 |
262. | 6.715403      49620 |
263. | 6.568218      49660 |
264. | 6.858422      49700 |
265. | 6.661957      49740 |
     +---------------------+

. save ../AccraData/sourcedata/gross_rents, replace
file ../AccraData/sourcedata/gross_rents.dta saved

. restore

. 
. log close
      name:  <unnamed>
       log:  /home/data/ransom/frictions-JHR/Data/Input/ACSpindex/an_adj_rent_MSA.log
  log type:  text
 closed on:  30 Jan 2021, 20:30:03
--------------------------------------------------------------------------------------------------
